<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Viajes</title>
    <script>
    window.onload = function() {
      alert("Debes activar el VPN");
    };
  </script>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header>
        <h1>Viajes</h1>
        <button id="menuButton">‚ò∞</button>
    </header>
    <nav id="menu">
        <ul>
            <li><a href="index.html">Inicio</a></li>
            <li><a href="frases.html">Frases</a></li>
            <li><a href="videos.html">Videos</a></li>
            <li><a href="preguntas y respuestas.html">Preguntas y Respuestas</a></li>
            <li><a href="reencuentro.html">Reencuentro</a></li>
        </ul>
    </nav>
    <main>
        <section>
            <center><h2>Galer√≠a de Viajes</h2></center>
            <div class="gallery">
                <div class="image-container" data-id="IMG_2486">
                <img src="IMG_2486.jpeg" alt="Viaje 1">
                    <div class="actions">
                <button class="like-button">‚ù§Ô∏è <span class="like-count">0</span></button>
                <button class="comment-button">üí¨</button>
            </div>
            <div class="comments">
                <textarea placeholder="Escribe un comentario..."></textarea>
                <button class="send-comment">Enviar</button>
                <div class="comment-list">
                    <!-- Aqu√≠ se mostrar√°n los comentarios -->
                </div>
            </div>
        </div>
               <div class="image-container" data-id="IMG_2487">
                <img src="IMG_2487.jpeg" alt="Viaje 2">
                    <div class="actions">
                <button class="like-button">‚ù§Ô∏è <span class="like-count">0</span></button>
                <button class="comment-button">üí¨</button>
            </div>
            <div class="comments">
                <textarea placeholder="Escribe un comentario..."></textarea>
                <button class="send-comment">Enviar</button>
                <div class="comment-list">
                    <!-- Aqu√≠ se mostrar√°n los comentarios -->
                </div>
            </div>
        </div>
              <div class="image-container" data-id="IMG_2493">
                <img src="IMG_2493.jpeg" alt="Viaje 3">
                    <div class="actions">
                <button class="like-button">‚ù§Ô∏è <span class="like-count">0</span></button>
                <button class="comment-button">üí¨</button>
            </div>
            <div class="comments">
                <textarea placeholder="Escribe un comentario..."></textarea>
                <button class="send-comment">Enviar</button>
                <div class="comment-list">
                    <!-- Aqu√≠ se mostrar√°n los comentarios -->
                </div>
            </div>
        </div>
              <div class="image-container" data-id="IMG_2494">
                <img src="IMG_2494.jpeg" alt="Viaje 4">
                    <div class="actions">
                <button class="like-button">‚ù§Ô∏è <span class="like-count">0</span></button>
                <button class="comment-button">üí¨</button>
            </div>
            <div class="comments">
                <textarea placeholder="Escribe un comentario..."></textarea>
                <button class="send-comment">Enviar</button>
                <div class="comment-list">
                    <!-- Aqu√≠ se mostrar√°n los comentarios -->
                </div>
            </div>
        </div>
               <div class="image-container" data-id="IMG_2497">
                <img src="IMG_2497.jpeg" alt="Viaje 5">
                    <div class="actions">
                <button class="like-button">‚ù§Ô∏è <span class="like-count">0</span></button>
                <button class="comment-button">üí¨</button>
            </div>
            <div class="comments">
                <textarea placeholder="Escribe un comentario..."></textarea>
                <button class="send-comment">Enviar</button>
                <div class="comment-list">
                    <!-- Aqu√≠ se mostrar√°n los comentarios -->
                </div>
            </div>
        </div>
              <div class="image-container" data-id="IMG_2498">
                <img src="IMG_2498.jpeg" alt="Viaje 6">
                    <div class="actions">
                <button class="like-button">‚ù§Ô∏è <span class="like-count">0</span></button>
                <button class="comment-button">üí¨</button>
            </div>
            <div class="comments">
                <textarea placeholder="Escribe un comentario..."></textarea>
                <button class="send-comment">Enviar</button>
                <div class="comment-list">
                    <!-- Aqu√≠ se mostrar√°n los comentarios -->
                </div>
            </div>
        </div>
              <div class="image-container" data-id="IMG_2516">
                <img src="IMG_2516.jpeg" alt="Viaje 7">
                    <div class="actions">
                <button class="like-button">‚ù§Ô∏è <span class="like-count">0</span></button>
                <button class="comment-button">üí¨</button>
            </div>
            <div class="comments">
                <textarea placeholder="Escribe un comentario..."></textarea>
                <button class="send-comment">Enviar</button>
                <div class="comment-list">
                    <!-- Aqu√≠ se mostrar√°n los comentarios -->
                </div>
            </div>
        </div>
               <div class="image-container" data-id="IMG_2517">
                <img src="IMG_2517.jpeg" alt="Viaje 8">
                    <div class="actions">
                <button class="like-button">‚ù§Ô∏è <span class="like-count">0</span></button>
                <button class="comment-button">üí¨</button>
            </div>
            <div class="comments">
                <textarea placeholder="Escribe un comentario..."></textarea>
                <button class="send-comment">Enviar</button>
                <div class="comment-list">
                    <!-- Aqu√≠ se mostrar√°n los comentarios -->
                </div>
            </div>
        </div>
                <!-- Agrega m√°s im√°genes aqu√≠ -->
            </div>
        </section>
    </main>
    <!-- Bot√≥n flotante -->
    <button id="upButton" onclick="scrollToTop()">‚Üë</button>
      <script>
        // Funci√≥n para desplazarse al principio de la p√°gina
        function scrollToTop() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // Mostrar el bot√≥n cuando se desplaza hacia abajo
        window.onscroll = function() {
            const upButton = document.getElementById('upButton');
            if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
                upButton.style.display = 'block';
            } else {
                upButton.style.display = 'none';
            }
        };
        
    </script>
    <script type="module">
    // Comentarios y reacciones
    // Importa los m√≥dulos de Firebase
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.1.3/firebase-app.js';
        import { getAuth, signInAnonymously } from 'https://www.gstatic.com/firebasejs/9.1.3/firebase-auth.js';
        import { getFirestore, collection, query, where, orderBy, getDocs, serverTimestamp, addDoc, doc, deleteDoc, updateDoc, getDoc, setDoc } from 'https://www.gstatic.com/firebasejs/9.1.3/firebase-firestore.js';
        
        // Configuraci√≥n de Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyBfGBf5Zmp1hEZHT9aKIhTRcXjULD-jbGw",
            authDomain: "mi-web-5402c.firebaseapp.com",
            databaseURL: "https://mi-web-5402c-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "mi-web-5402c",
            storageBucket: "mi-web-5402c.appspot.com",
            messagingSenderId: "31272724190",
            appId: "1:31272724190:web:51fcc8750c51abf783844f"
        };
        
        // Inicializa Firebase
        const app = initializeApp(firebaseConfig);
        console.log("Firebase inicializado");

// Autenticaci√≥n an√≥nima
const auth = getAuth(app);
signInAnonymously(auth)
.then(() => {
                console.log("Autenticaci√≥n an√≥nima exitosa");
                })
            .catch((error) => {
                alert("Error al autenticar: " + error.message);
            });

// Referencia a Firestore
const db = getFirestore(app);
console.log("Firestore inicializado");

// Funci√≥n para reacci√≥n me gusta
async function toggleLike(imageId, userId, button, likeCount) {
    try {
        const likeRef = doc(db, "likes", `${imageId}_${userId}`);
        const likeDoc = await getDoc(likeRef);

        if (likeDoc.exists()) {
            // Si el usuario ya ha dado "me gusta", eliminar el documento
            await deleteDoc(likeRef);
            button.classList.remove('liked');
            likeCount.textContent = parseInt(likeCount.textContent) - 1;
            console.log("Me gusta eliminado");
        } else {
            // Si el usuario no ha dado "me gusta", crear el documento
            await setDoc(likeRef, {
                imageId: imageId,
                userId: userId,
                timestamp: serverTimestamp()
            });
            button.classList.add('liked');
            likeCount.textContent = parseInt(likeCount.textContent) + 1;
            console.log("Me gusta a√±adido");
        }
    } catch (error) {
        console.error("Error al cambiar el estado de 'me gusta':", error);
    }
}

document.addEventListener('DOMContentLoaded', () => {
    const likeButtons = document.querySelectorAll('.like-button');
    const commentButtons = document.querySelectorAll('.comment-button');
    const sendCommentButtons = document.querySelectorAll('.send-comment');

    likeButtons.forEach(button => {
        button.addEventListener('click', () => {
            const likeCount = button.querySelector('.like-count');
            const imageId = button.closest('.image-container').dataset.id;
            const userId = "user123"; // Reemplaza esto con el ID del usuario actual

            toggleLike(imageId, userId, button, likeCount);
        });
    });

    // C√≥digo existente para los botones de comentarios...
});


// Funci√≥n para guardar comentarios
async function saveComment(imageId, comment) {
    try {
        await addDoc(collection(db, "comments"), {
            imageId: imageId,
            text: comment,
            timestamp: serverTimestamp()
        });
        console.log("Comentario guardado correctamente");
    } catch (error) {
        console.error("Error al guardar el comentario:", error);
    }
}

// Funci√≥n para cargar comentarios
async function loadComments(imageId, commentList) {
    try {
        const q = query(collection(db, "comments"), where("imageId", "==", imageId), orderBy("timestamp"));
        const querySnapshot = await getDocs(q);
        querySnapshot.forEach((doc) => {
            const comment = doc.data().text;
            const commentId = doc.id;
            const newComment = document.createElement('div');
            newComment.classList.add('comment');
            newComment.dataset.id = commentId; // A√±adir el ID del comentario
            newComment.innerHTML = `
                <div class="comment-content">
                    <span>${comment}</span>
                    <div>
                        <button class="edit-button">‚úèÔ∏è</button>
                        <button class="delete-button">üóëÔ∏è</button>
                    </div>
                </div>
            `;
            commentList.appendChild(newComment);

            // A√±adir eventos a los botones de edici√≥n y eliminaci√≥n
            newComment.querySelector('.edit-button').addEventListener('click', () => {
                const newText = prompt('Edita tu comentario:', comment);
                if (newText) {
                    editComment(commentId, newText).then(() => {
                        newComment.querySelector('span').textContent = newText;
                    });
                }
            });

            newComment.querySelector('.delete-button').addEventListener('click', () => {
                if (confirm("¬øEst√°s seguro de que deseas eliminar este comentario?")) {
                    deleteComment(commentId).then(() => {
                        newComment.remove();
                    });
                }
            });
        });
    } catch (error) {
        alert("Error al cargar los comentarios: " + error.message);
    }
}

// Funci√≥n para editar comentarios
async function editComment(commentId, newText) {
    try {
        const commentRef = doc(db, "comments", commentId);
        await updateDoc(commentRef, {
            text: newText,
            timestamp: serverTimestamp()
        });
        console.log("Comentario editado correctamente");
    } catch (error) {
        console.error("Error al editar el comentario:", error);
    }
}

// Funci√≥n para eliminar comentarios
async function deleteComment(commentId) {
    try {
        const commentRef = doc(db, "comments", commentId);
        await deleteDoc(commentRef);
        console.log("Comentario eliminado correctamente");
    } catch (error) {
        console.error("Error al eliminar el comentario:", error);
    }
}

// Eventos del DOM
document.addEventListener('DOMContentLoaded', () => {
    const likeButtons = document.querySelectorAll('.like-button');
    const commentButtons = document.querySelectorAll('.comment-button');
    const sendCommentButtons = document.querySelectorAll('.send-comment');

    likeButtons.forEach(button => {
        button.addEventListener('click', () => {
            const likeCount = button.querySelector('.like-count');
            if (button.classList.toggle('liked')) {
                likeCount.textContent = parseInt(likeCount.textContent) + 1;
            } else {
                likeCount.textContent = parseInt(likeCount.textContent) - 1;
            }
            console.log("Like button clicked");
        });
    });

    commentButtons.forEach(button => {
        button.addEventListener('click', (event) => {
            const commentsSection = event.target.closest('.image-container').querySelector('.comments');
            commentsSection.style.display = commentsSection.style.display === 'flex' ? 'none' : 'flex';
            if (commentsSection.style.display === 'flex') {
                const commentList = commentsSection.querySelector('.comment-list');
                const imageId = event.target.closest('.image-container').dataset.id;
                console.log("Loading comments for imageId:", imageId);
                loadComments(imageId, commentList);
            }
        });
    });

    sendCommentButtons.forEach(button => {
        button.addEventListener('click', (event) => {
            const commentText = event.target.previousElementSibling.value;
            const imageId = event.target.closest('.image-container').dataset.id;
            if (commentText) {
                console.log("Sending comment:", commentText);
                saveComment(imageId, commentText)
                    .then(() => {
                        const commentList = event.target.closest('.comments').querySelector('.comment-list');
                        const newComment = document.createElement('div');
                        newComment.classList.add('comment');
                        newComment.innerHTML = `
                            <div class="comment-content">
                                <span>${commentText}</span>
                                <div>
                                    <button class="edit-button">‚úèÔ∏è</button>
                                    <button class="delete-button">üóëÔ∏è</button>
                                </div>
                            </div>
                        `;
                        commentList.appendChild(newComment);
                        event.target.previousElementSibling.value = '';

                        // A√±adir eventos a los nuevos botones de edici√≥n y eliminaci√≥n
                        newComment.querySelector('.edit-button').addEventListener('click', () => {
                            const newText = prompt('Edita tu comentario:', commentText);
                            if (newText) {
                                editComment(newComment.dataset.id, newText).then(() => {
                                    newComment.querySelector('span').textContent = newText;
                                });
                            }
                        });

                        newComment.querySelector('.delete-button').addEventListener('click', () => {
                            if (confirm("¬øEst√°s seguro de que deseas eliminar este comentario?")) {
                                deleteComment(newComment.dataset.id).then(() => {
                                    newComment.remove();
                                });
                            }
                        });
                    })
                    .catch(error => {
                        console.error("Error saving comment:", error);
                    });
            }
        });
    });
});
    
    document.querySelectorAll('.edit-button').forEach(button => {
        button.addEventListener('click', (event) => {
            const commentId = event.target.closest('.comment').dataset.id;
            const newText = prompt("Edita tu comentario:");
            if (newText) {
                editComment(commentId, newText);
            }
        });
    });

    document.querySelectorAll('.delete-button').forEach(button => {
        button.addEventListener('click', (event) => {
            const commentId = event.target.closest('.comment').dataset.id;
            if (confirm("¬øEst√°s seguro de que deseas eliminar este comentario?")) {
                deleteComment(commentId);
            }
        });
    });

</script>
<script src="scripts.js"></script>
</body>
</html>
