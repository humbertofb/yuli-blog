<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Viajes</title>
<script>
window.onload = function() {
alert("Debes activar el VPN");
};
</script>
<link rel="stylesheet" href="styles.css">
</head>
<body>
<header>
<h1>Viajes</h1>
<button id="menuButton">â˜°</button>
</header>
<nav id="menu">
<ul>
<li><a href="index.html">Inicio</a></li>
<li><a href="frases.html">Frases</a></li>
<li><a href="videos.html">Videos</a></li>
<li><a href="preguntas y respuestas.html">Preguntas y Respuestas</a></li>
<li><a href="reencuentro.html">Reencuentro</a></li>
</ul>
</nav>
<main>
<section>
<center><h2>GalerÃ­a de Viajes</h2></center>
<button class="like-button">â¤ï¸ <span class="like-count">0</span></button>
<button class="comment-button">ğŸ’¬</button>
</div>
<div class="comments">
<textarea placeholder="Escribe un comentario..."></textarea>
<button class="send-comment">Enviar</button>
<div class="comment-list">
<!-- AquÃ­ se mostrarÃ¡n los comentarios -->
</div>
</div>
</div>

<div class="image-container" data-id="IMG_2487">
<img src="IMG_2487.jpeg" alt="Viaje 2">
<div class="actions">
<button class="like-button">â¤ï¸ <span class="like-count">0</span></button>
<button class="comment-button">ğŸ’¬</button>
</div>
<div class="comments">
<textarea placeholder="Escribe un comentario..."></textarea>
<button class="send-comment">Enviar</button>
<div class="comment-list">
<!-- AquÃ­ se mostrarÃ¡n los comentarios -->
</div>
</div>
</div>
<div class="image-container" data-id="IMG_2493">
<img src="IMG_2493.jpeg" alt="Viaje 3">
<div class="actions">
<button class="like-button">â¤ï¸ <span class="like-count">0</span></button>
<button class="comment-button">ğŸ’¬</button>
</div>
<div class="comments">
<textarea placeholder="Escribe un comentario..."></textarea>
<button class="send-comment">Enviar</button>
<div class="comment-list">
<!-- AquÃ­ se mostrarÃ¡n los comentarios -->
</div>
</div>
</div>
<div class="image-container" data-id="IMG_2494">
<img src="IMG_2494.jpeg" alt="Viaje 4">
<div class="actions">
<button class="like-button">â¤ï¸ <span class="like-count">0</span></button>
<button class="comment-button">ğŸ’¬</button>
</div>
<div class="comments">
<textarea placeholder="Escribe un comentario..."></textarea>
<button class="send-comment">Enviar</button>
<div class="comment-list">
<!-- AquÃ­ se mostrarÃ¡n los comentarios -->
</div>
</div>
</div>
<div class="image-container" data-id="IMG_2497">
<img src="IMG_2497.jpeg" alt="Viaje 5">
<div class="actions">
<button class="like-button">â¤ï¸ <span class="like-count">0</span></button>
<button class="comment-button">ğŸ’¬</button>
</div>
<div class="comments">
<textarea placeholder="Escribe un comentario..."></textarea>
<button class="send-comment">Enviar</button>
<div class="comment-list">
<!-- AquÃ­ se mostrarÃ¡n los comentarios -->
</div>
</div>
</div>
<div class="image-container" data-id="IMG_2498">
<img src="IMG_2498.jpeg" alt="Viaje 6">
<div class="actions">
<button class="like-button">â¤ï¸ <span class="like-count">0</span></button>
<button class="comment-button">ğŸ’¬</button>
</div>
<div class="comments">
<textarea placeholder="Escribe un comentario..."></textarea>
<button class="send-comment">Enviar</button>
<div class="comment-list">
<!-- AquÃ­ se mostrarÃ¡n los comentarios -->
</div>
</div>
</div>
<div class="image-container" data-id="IMG_2516">
<img src="IMG_2516.jpeg" alt="Viaje 7">
<div class="actions">
<button class="like-button">â¤ï¸ <span class="like-count">0</span></button>
<button class="comment-button">ğŸ’¬</button>
</div>
<div class="comments">
<textarea placeholder="Escribe un comentario..."></textarea>
<button class="send-comment">Enviar</button>
<div class="comment-list">
<!-- AquÃ­ se mostrarÃ¡n los comentarios -->
</div>
</div>
</div>
<div class="image-container" data-id="IMG_2517">
<img src="IMG_2517.jpeg" alt="Viaje 8">
<div class="actions">
<button class="like-button">â¤ï¸ <span class="like-count">0</span></button>
<button class="comment-button">ğŸ’¬</button>
</div>
<div class="comments">
<textarea placeholder="Escribe un comentario..."></textarea>
<button class="send-comment">Enviar</button>
<div class="comment-list">
<!-- AquÃ­ se mostrarÃ¡n los comentarios -->
</div>
</div>
</div>
<!-- Agrega mÃ¡s imÃ¡genes aquÃ­ -->
</div>
</section>
</main>
<!-- BotÃ³n flotante -->
<button id="upButton" onclick="scrollToTop()">â†‘</button>
<script>
// FunciÃ³n para desplazarse al principio de la pÃ¡gina
function scrollToTop() {
window.scrollTo({ top: 0, behavior: 'smooth' });
}

// Mostrar el botÃ³n cuando se desplaza hacia abajo
window.onscroll = function() {
const upButton = document.getElementById('upButton');
if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
upButton.style.display = 'block';
} else {
upButton.style.display = 'none';
}
};

</script>
<script type="module">
// Comentarios y reacciones
// Importa los mÃ³dulos de Firebase
import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.1.3/firebase-app.js';
import { getAuth, signInAnonymously, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/9.1.3/firebase-auth.js';
import { getFirestore, collection, query, where, orderBy, getDocs, serverTimestamp, addDoc, doc, deleteDoc, updateDoc, getDoc, setDoc } from 'https://www.gstatic.com/firebasejs/9.1.3/firebase-firestore.js';

// ConfiguraciÃ³n de Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyBfGBf5Zmp1hEZHT9aKIhTRcXjULD-jbGw",
            authDomain: "mi-web-5402c.firebaseapp.com",
            databaseURL: "https://mi-web-5402c-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "mi-web-5402c",
            storageBucket: "mi-web-5402c.appspot.com",
            messagingSenderId: "31272724190",
            appId: "1:31272724190:web:51fcc8750c51abf783844f"
        };

// Inicializa Firebase
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const auth = getAuth();
let userId = null;

// Autenticar usuario anÃ³nimo
signInAnonymously(auth)
.then(() => {
console.log("Usuario anÃ³nimo autenticado");
})
.catch((error) => {
console.error("Error al autenticar usuario anÃ³nimo:", error);
});

// Obtener el ID del usuario autenticado
onAuthStateChanged(auth, (user) => {
if (user) {
userId = user.uid; // El ID Ãºnico del usuario autenticado
console.log("Usuario autenticado:", userId);
} else {
console.log("No hay usuario autenticado");
}
});

// FunciÃ³n para guardar comentarios
async function saveComment(imageId, comment) {
try {
await addDoc(collection(db, "comments"), {
imageId: imageId,
text: comment,
timestamp: serverTimestamp()
});
console.log("Comentario guardado correctamente");
} catch (error) {
console.error("Error al guardar el comentario:", error);
}
}

// FunciÃ³n para cargar comentarios
async function loadComments(imageId, commentList) {
try {
// Limpiar la lista de comentarios antes de cargar nuevos
commentList.innerHTML = '';
const q = query(collection(db, "comments"), where("imageId", "==", imageId), orderBy("timestamp"));
const querySnapshot = await getDocs(q);
querySnapshot.forEach((doc) => {
const comment = doc.data().text;
const commentId = doc.id;
const newComment = document.createElement('div');
newComment.classList.add('comment');
newComment.dataset.id = commentId; // AÃ±adir el ID del comentario
newComment.innerHTML = `
<div class="comment-content">
<span>${comment}</span>
<div>
<button class="edit-button">âœï¸</button>
<button class="delete-button">ğŸ—‘ï¸ï¸</button>
</div>
</div>
`;
commentList.appendChild(newComment);

// AÃ±adir eventos a los botones de ediciÃ³n y eliminaciÃ³n
newComment.querySelector('.edit-button').addEventListener('click', () => {
const newText = prompt('Edita tu comentario:', comment);
if (newText) {
editComment(commentId, newText).then(() => {
newComment.querySelector('span').textContent = newText;
});
}
});

newComment.querySelector('.delete-button').addEventListener('click', () => {
if (confirm("Â¿EstÃ¡s seguro de que deseas eliminar este comentario?")) {
deleteComment(commentId).then(() => {
newComment.remove();
});
}
});
});
} catch (error) {
alert("Error al cargar los comentarios: " + error.message);
}
}

// FunciÃ³n para editar comentarios
async function editComment(commentId, newText) {
try {
const commentRef = doc(db, "comments", commentId);
await updateDoc(commentRef, {
text: newText,
timestamp: serverTimestamp()
});
console.log("Comentario editado correctamente");
} catch (error) {
console.error("Error al editar el comentario:", error);
}
}

// FunciÃ³n para eliminar comentarios
async function deleteComment(commentId) {
try {
const commentRef = doc(db, "comments", commentId);
await deleteDoc(commentRef);
console.log("Comentario eliminado correctamente");
} catch (error) {
console.error("Error al eliminar el comentario:", error);
}
}

// FunciÃ³n para guardar "me gusta"
async function saveLike(imageId, userId, liked) {
try {
const likeRef = doc(db, "likes", imageId);
const likeDoc = await getDoc(likeRef);
let newCount = 0;
if (likeDoc.exists()) {
const data = likeDoc.data();
newCount = data.count;
if (liked) {
newCount += 1;
} else {
newCount -= 1;
}
} else {
newCount = liked ? 1 : 0;
}
await setDoc(likeRef, { count: newCount }, { merge: true });
console.log("Me gusta guardado correctamente");
} catch (error) {
console.error("Error al guardar el me gusta:", error);
}
}

// FunciÃ³n para cargar "me gusta"
async function loadLikes(imageId, likeButton, likeCount) {
try {
const likeRef = doc(db, "likes", imageId);
const likeDoc = await getDoc(likeRef);
if (likeDoc.exists()) {
const data = likeDoc.data();
likeCount.textContent = data.count;
if (data.count > 0) {
likeButton.classList.add('liked');
}
}
} catch (error) {
console.error("Error al cargar los me gusta:", error);
}
}

// FunciÃ³n para alternar "me gusta"
async function toggleLike(imageId, userId, likeButton, likeCount) {
try {
const userLikeRef = doc(db, "userLikes", `${imageId}_${userId}`);
const userLikeDoc = await getDoc(userLikeRef);
let liked = false;
if (userLikeDoc.exists()) {
liked = userLikeDoc.data().liked;
liked = !liked;
} else {
liked = true;
}
await setDoc(userLikeRef, { liked: liked }, { merge: true });
await saveLike(imageId, userId, liked);
const likeRef = doc(db, "likes", imageId);
const likeDoc = await getDoc(likeRef);
if (likeDoc.exists()) {
const data = likeDoc.data();
likeCount.textContent = data.count;
if (liked) {
likeButton.classList.add('liked');
} else {
likeButton.classList.remove('liked');
}
}
} catch (error) {
console.error("Error al alternar el me gusta:", error);
}
}

// FunciÃ³n para adjuntar eventos a los comentarios
function attachCommentEvents(commentElement, commentId, commentText) {
commentElement.querySelector('.edit-button').addEventListener('click', () => {
const newText = prompt('Edita tu comentario:', commentText);
if (newText) {
editComment(commentId, newText).then(() => {
commentElement.querySelector('span').textContent = newText;
});
}
});

commentElement.querySelector('.delete-button').addEventListener('click', () => {
if (confirm("Â¿EstÃ¡s seguro de que deseas eliminar este comentario?")) {
deleteComment(commentId).then(() => {
commentElement.remove();
});
}
});
}

// Eventos del DOM
document.addEventListener('DOMContentLoaded', () => {
const likeButtons = document.querySelectorAll('.like-button');
const commentButtons = document.querySelectorAll('.comment-button');
const sendCommentButtons = document.querySelectorAll('.send-comment');

likeButtons.forEach(button => {
const imageId = button.closest('.image-container').dataset.id;
const likeCount = button.querySelector('.like-count');
loadLikes(imageId, button, likeCount);

button.addEventListener('click', (event) => {
if (userId) {
toggleLike(imageId, userId, button, likeCount);
} else {
console.log("Usuario no autenticado");
}
});
});

commentButtons.forEach(button => {
button.addEventListener('click', (event) => {
const commentsSection = event.target.closest('.image-container').querySelector('.comments');
commentsSection.style.display = commentsSection.style.display === 'flex' ? 'none' : 'flex';
if (commentsSection.style.display === 'flex') {
const commentList = commentsSection.querySelector('.comment-list');
const imageId = event.target.closest('.image-container').dataset.id;
console.log("Cargando comentarios:", imageId);
loadComments(imageId, commentList);
}
});
});

sendCommentButtons.forEach(button => {
button.addEventListener('click', (event) => {
const commentText = event.target.previousElementSibling.value;
const imageId = event.target.closest('.image-container').dataset.id;
if (commentText) {
console.log("Enviando comentario:", commentText);
saveComment(imageId, commentText)
.then(() => {
const commentList = event.target.closest('.comments').querySelector('.comment-list');
const newComment = document.createElement('div');
newComment.classList.add('comment');
newComment.innerHTML = `
<div class="comment-content">
<span>${commentText}</span>
<div>
<button class="edit-button">âœï¸</button>
<button class="delete-button">ï¸ğŸ—‘ï¸</button>
</div>
</div>
`;
commentList.appendChild(newComment);
event.target.previousElementSibling.value = "";
})
.catch(error => {
console.error("Error guardando el comentario:", error);
});
}
});
});
});
</script>
<script src="scripts.js"></script>
</body>
</html>