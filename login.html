<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Inicio de Sesión</title>
<style>
/* Estilos generales */
body {
font-family: 'Arial', sans-serif;
background-color: #ffe6e6;
color: #333;
margin: 0;
padding: 0;
display: flex;
justify-content: center;
align-items: center;
height: 100vh;
}

/* Cuadro de autenticación */
.auth-box {
background-color: #fff;
padding: 20px;
border-radius: 10px;
box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
width: 300px;
text-align: center;
}

.auth-box h2 {
margin-bottom: 20px;
}

.auth-box form {
display: none;
}

.auth-box form.active {
display: block;
}

.auth-box label {
display: block;
margin-bottom: 5px;
}

.auth-box input {
width: 100%;
padding: 10px;
margin-bottom: 10px;
border: 1px solid #ccc;
border-radius: 5px;
}

.auth-box button {
padding: 10px 20px;
background-color: #ff6666;
color: #fff;
border: none;
border-radius: 5px;
cursor: pointer;
width: 100%;
margin-bottom: 10px;
}

.auth-box button:hover {
background-color: #ff3333;
}

.auth-box .toggle-button {
background-color: transparent;
color: #ff6666;
border: none;
cursor: pointer;
text-decoration: underline;
margin-top: 10px;
}

/* Estilos para los modales */
.modal {
display: none;
position: fixed;
z-index: 1;
left: 0;
top: 0;
width: 100%;
height: 100%;
overflow: auto;
background-color: rgba(0, 0, 0, 0.4);
}

.modal-content {
background-color: #fff;
margin: 15% auto;
padding: 20px;
border: 1px solid #888;
width: 80%;
max-width: 400px;
border-radius: 10px;
text-align: center;
}

.close {
color: #aaa;
float: right;
font-size: 28px;
font-weight: bold;
}

.close:hover,
.close:focus {
color: black;
text-decoration: none;
cursor: pointer;
}
</style>
</head>
<body>
<div class="auth-box">
<h2 id="form-title">Iniciar Sesión</h2>
<form id="login-form" class="active">
<label for="login-email">Correo Electrónico:</label>
<input type="email" id="login-email" required>
<label for="login-password">Contraseña:</label>
<input type="password" id="login-password" required>
<button type="submit">Iniciar Sesión</button>
</form>
<form id="register-form">
<label for="register-email">Correo Electrónico:</label>
<input type="email" id="register-email" required>
<label for="register-password">Contraseña:</label>
<input type="password" id="register-password" required>
<button type="submit">Registrarse</button>
</form>
<button id="google-login" class="social-login">
<img src="https://img.icons8.com/color/16/000000/google-logo.png" alt="Google Logo"> Iniciar sesión con Google
</button>
<button id="toggle-form" class="toggle-button">Registrarse</button>
</div>

<!-- Modales para mensajes de error -->
<div id="error-modal" class="modal">
<div class="modal-content">
<span class="close">×</span>
<p id="error-message"></p>
</div>
</div>

<!-- Formulario para subir imagen de perfil -->
<form id="profile-pic-form">
<input type="file" id="profile-pic-input" accept="image/*">
<button type="submit">Subir Imagen de Perfil</button>
</form>
<img id="profile-pic" src="" alt="Imagen de Perfil">
<button id="delete-profile-pic">Eliminar Imagen de Perfil</button>
<button id="edit-profile-pic">Editar Imagen de Perfil</button>

<script type="module">
import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.1.3/firebase-app.js';
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signInWithPopup, GoogleAuthProvider } from 'https://www.gstatic.com/firebasejs/9.1.3/firebase-auth.js';
import { getFirestore, doc, getDoc, setDoc, updateDoc, collection, addDoc, serverTimestamp } from 'https://www.gstatic.com/firebasejs/9.1.3/firebase-firestore.js';
import { getStorage, ref, uploadBytes, getDownloadURL, deleteObject } from 'https://www.gstatic.com/firebasejs/9.1.3/firebase-storage.js';

const firebaseConfig = {
apiKey: "AIzaSyBfGBf5Zmp1hEZHT9aKIhTRcXjULD-jbGw",
authDomain: "mi-web-5402c.firebaseapp.com",
databaseURL: "https://mi-web-5402c-default-rtdb.europe-west1.firebasedatabase.app",
projectId: "mi-web-5402c",
storageBucket: "mi-web-5402c.appspot.com",
messagingSenderId: "31272724190",
appId: "1:31272724190:web:51fcc8750c51abf783844f"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);
const storage = getStorage(app);

// Alternar entre formularios de inicio de sesión y registro
document.getElementById('toggle-form').addEventListener('click', () => {
const loginForm = document.getElementById('login-form');
const registerForm = document.getElementById('register-form');
const formTitle = document.getElementById('form-title');
const toggleButton = document.getElementById('toggle-form');

if (loginForm.classList.contains('active')) {
loginForm.classList.remove('active');
registerForm.classList.add('active');
formTitle.textContent = 'Registrarse';
toggleButton.textContent = 'Iniciar Sesión';
} else {
registerForm.classList.remove('active');
loginForm.classList.add('active');
formTitle.textContent = 'Iniciar Sesión';
toggleButton.textContent = 'Registrarse';
}
});

// Mostrar modal de error
function showErrorModal(message) {
const modal = document.getElementById('error-modal');
const errorMessage = document.getElementById('error-message');
errorMessage.textContent = message;
modal.style.display = 'block';
}

// Cerrar modal de error
document.querySelector('.close').addEventListener('click', () => {
document.getElementById('error-modal').style.display = 'none';
});

// Registro de Usuario
document.getElementById('register-form').addEventListener('submit', async (e) => {
e.preventDefault();
const email = document.getElementById('register-email').value;
const password = document.getElementById('register-password').value;
try {
await createUserWithEmailAndPassword(auth, email, password);
window.location.href = 'cuadro de emociones.html'; // Redirigir a la página de emociones
} catch (error) {
if (error.code === 'auth/email-already-in-use') {
showErrorModal('El correo electrónico ya está en uso. Por favor, inicia sesión.');
} else if (error.code === 'auth/invalid-email') {
showErrorModal('El correo electrónico no es válido.');
} else if (error.code === 'auth/weak-password') {
showErrorModal('La contraseña es demasiado débil.');
} else {
showErrorModal('Error en el registro: ' + error.message);
}
}
});

// Login de Usuario
document.getElementById('login-form').addEventListener('submit', async (e) => {
e.preventDefault();
const email = document.getElementById('login-email').value;
const password = document.getElementById('login-password').value;
try {
await signInWithEmailAndPassword(auth, email, password);
window.location.href = 'cuadro de emociones.html'; // Redirigir a la página de emociones
} catch (error) {
if (error.code === 'auth/user-not-found') {
showErrorModal('Usuario no registrado. Por favor, regístrese en el sistema.');
} else if (error.code === 'auth/invalid-email') {
showErrorModal('El correo electrónico no es válido.');
} else if (error.code === 'auth/wrong-password') {
showErrorModal('La contraseña es incorrecta.');
} else {
showErrorModal('Error en el login: ' + error.message);
}
}
});

// Subir imagen de perfil
document.getElementById('profile-pic-form').addEventListener('submit', async (e) => {
e.preventDefault();
const file = document.getElementById('profile-pic-input').files[0];
if (file) {
const user = auth.currentUser;
const storageRef = ref(storage, `profile_pics/${user.uid}`);
try {
await uploadBytes(storageRef, file);
const url = await getDownloadURL(storageRef);

const userDocRef = doc(db, 'users', user.uid);
const userDoc = await getDoc(userDocRef);

if (userDoc.exists()) {
await updateDoc(userDocRef, { profilePic: url });
} else {
await setDoc(userDocRef, { profilePic: url });
}

document.getElementById('profile-pic').src = url;
alert('Imagen de perfil subida con éxito');
} catch (error) {
console.error('Error al subir la imagen de perfil:', error);
}
}
});

// Eliminar imagen de perfil
document.getElementById('delete-profile-pic').addEventListener('click', async () => {
const user = auth.currentUser;
const storageRef = ref(storage, `profile_pics/${user.uid}`);
try {
await deleteObject(storageRef);

const userDocRef = doc(db, 'users', user.uid);
await updateDoc(userDocRef, { profilePic: '' });

document.getElementById('profile-pic').src = '';
alert('Imagen de perfil eliminada con éxito');
} catch (error) {
console.error('Error al eliminar la imagen de perfil:', error);
}
});

// Editar imagen de perfil
document.getElementById('edit-profile-pic').addEventListener('click', () => {
document.getElementById('profile-pic-input').click();
});

// Cargar imagen de perfil
async function loadProfilePic(uid) {
try {
const userDoc = await getDoc(doc(db, 'users', uid));
if (userDoc.exists() && userDoc.data().profilePic) {
document.getElementById('profile-pic').src = userDoc.data().profilePic;
}
} catch (error) {
console.error('Error al cargar la imagen de perfil:', error);
}
}

// Guardar datos en Firebase
document.getElementById('emotion-form').addEventListener('submit', async (e) => {
e.preventDefault();

const emotion = document.getElementById('emotion').value;
const note = document.getElementById('note').value;

try {
await addDoc(collection(db, 'emotions'), {
emotion,
note,
timestamp: serverTimestamp()
});
alert('Emoción guardada con éxito');
loadEmotions(); // Recargar emociones después de guardar
} catch (e) {
console.error('Error al guardar la emoción:', e);
}
});

// Cargar emociones
async function loadEmotions() {
// Implementa la lógica para cargar y mostrar las emociones guardadas
}

// Inicializar la imagen de perfil al cargar la página
auth.onAuthStateChanged((user) => {
if (user) {
loadProfilePic(user.uid);
}
});
</script>
</body>
</html>
