<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Árbol de Metas</title>
<link rel="stylesheet" href="styles.css">
<style>
/* Estilos básicos para el árbol y los elementos */
#tree {
width: 100%;
height: 500px;
background: url('imágenes/IMG_3054.png') no-repeat center center;
background-size: contain;
position: relative;
}
.goal {
position: absolute;
background-color: rgba(255, 255, 255, 0.8);
padding: 5px;
border-radius: 5px;
cursor: pointer;
}
.goal.completed {
background-color: rgba(144, 238, 144, 0.8);
}
</style>
</head>
<body>
<header>
<h1>Árbol de Metas</h1>
<button id="menuButton">☰</button>
</header>
<nav id="menu">
<ul>
<li><a href="index.html">Inicio</a></li>
<li><a href="videos.html">Videos</a></li>
<li><a href="viajes.html">Viajes</a></li>
<li><a href="preguntas y respuestas.html">Preguntas y Respuestas</a></li>
<li><a href="reencuentro.html">Reencuentro</a></li>
</ul>
</nav>
<main>
<section>
<h2>Detalles del Árbol de Metas</h2>
<div id="tree">
<!-- Las metas se mostrarán aquí -->
</div>
<h3>Agregar Meta</h3>
<form id="goalForm">
<label for="goalDescription">Descripción:</label>
<input type="text" id="goalDescription" name="goalDescription" required>
<label for="goalDate">Fecha Objetivo:</label>
<input type="date" id="goalDate" name="goalDate" required>
<label for="goalType">Tipo de Meta:</label>
<select id="goalType" name="goalType" required>
<option value="corto">Corto Plazo</option>
<option value="mediano">Mediano Plazo</option>
<option value="largo">Largo Plazo</option>
</select>
<button type="submit">Agregar</button>
</form>
</section>
</main>
<script src="scripts.js"></script>
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
import { getDatabase, ref, push, onValue, update } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js";
import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js";

const firebaseConfig = {
apiKey: "AIzaSyBfGBf5Zmp1hEZHT9aKIhTRcXjULD-jbGw",
authDomain: "mi-web-5402c.firebaseapp.com",
databaseURL: "https://mi-web-5402c-default-rtdb.europe-west1.firebasedatabase.app",
projectId: "mi-web-5402c",
storageBucket: "mi-web-5402c.appspot.com",
messagingSenderId: "31272724190",
appId: "1:31272724190:web:51fcc8750c51abf783844f"
};

const app = initializeApp(firebaseConfig);
const database = getDatabase(app);
const auth = getAuth(app);

signInAnonymously(auth).catch((error) => {
console.error('Error al iniciar sesión anónima:', error);
});

onAuthStateChanged(auth, (user) => {
if (user) {
console.log('Usuario autenticado:', user);

const goalsRef = ref(database, 'goals');
onValue(goalsRef, (snapshot) => {
const tree = document.getElementById('tree');
tree.innerHTML = ''; // Limpiar el árbol antes de agregar las metas

snapshot.forEach((childSnapshot) => {
const goal = childSnapshot.val();
const goalElement = document.createElement('div');
goalElement.classList.add('goal');
if (goal.completed) {
goalElement.classList.add('completed');
}
goalElement.style.top = goal.position.top;
goalElement.style.left = goal.position.left;
goalElement.innerHTML = `
<strong>${goal.description}</strong>
<p>${goal.date}</p>
`;
goalElement.addEventListener('click', () => {
const newStatus = !goal.completed;
update(ref(database, 'goals/' + childSnapshot.key), { completed: newStatus });
});
tree.appendChild(goalElement);
});
}, (error) => {
console.error('Error al leer las metas:', error);
});
} else {
console.log('Usuario no autenticado');
}
});

document.getElementById('goalForm').addEventListener('submit', function(event) {
event.preventDefault();

const user = auth.currentUser;
if (user) {
const description = document.getElementById('goalDescription').value;
const date = document.getElementById('goalDate').value;
const type = document.getElementById('goalType').value;

const position = {
top: `${Math.random() * 80 + 10}%`,
left: `${Math.random() * 80 + 10}%`
};

push(ref(database, 'goals'), {
description: description,
date: date,
type: type,
position: position,
completed: false
}).then(() => {
alert('Meta agregada');
document.getElementById('goalForm').reset();
}).catch((error) => {
console.error('Error al agregar la meta:', error);
});
} else {
alert('Por favor, espera a que el sistema complete la autenticación.');
}
});
</script>
</body>
</html>